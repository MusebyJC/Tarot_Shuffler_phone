

:root{
  /* Theme */
  --gold: #ffd36a;
  --gold2: #ffb200;
  --gold3: #fff1b0;
  --goldGlow1: rgba(255, 210, 90, 0.65);
  --goldGlow2: rgba(255, 170, 0, 0.55);

  --mystic: #9b5cff;
  --mysticEdge: #3a1871;
  --mysticGlow1: rgba(155,92,255,0.70);
  --mysticGlow2: rgba(148, 107, 213, 0.7);

  /* Wheel sizing */
  --rowH: clamp(42px, 10.5vw, 58px);
  --padRows: 1;
  --visibleRows: 3;

  /* Layout (more flexible on big phones) */
  --panelW: min(92vw, 520px);
  --gap: 12px;
  --controlBtnH: clamp(46px, 12vw, 60px);
  --controlRadius: 14px;

  --highlightOffset: 0px; /* positive moves DOWN */
}



*{ margin:0; padding:0; box-sizing:border-box; }

html, body{
  width:100%;
  height:100%;
  overflow:hidden;
  background:#0a0a12;
  color:#fff;
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

#app{
  width: 100vw;
  height: 100dvh;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ============================================================
   PICKER
   ============================================================ */
.picker-screen{
  width: 100vw;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  align-items: center;

  /* ✅ center the whole content better on tall screens */
  justify-content: center;

  padding:
    calc(3vh + env(safe-area-inset-top))
    0
    calc(3vh + env(safe-area-inset-bottom));

  overflow: hidden;
}

.logo-wrap{
  width: clamp(120px, 34vw, 210px);
  display: flex;
  justify-content: center;
  margin-bottom: 1.2vh;
}

.picker-logo{
  width: 100%;
  height: auto;
  display: block;
  filter:
    drop-shadow(0 0 10px rgba(255,210,90,0.32))
    drop-shadow(0 0 20px rgba(155,92,255,0.28));
}

.picker-logo.frozen{
  filter:
    drop-shadow(0 0 9px rgba(255,210,90,0.42))
    drop-shadow(0 0 16px rgba(155,92,255,0.22));
}

.picker-title{ font-size: clamp(18px, 5vw, 28px); margin: 0 0 0.5vh; }

.title-gif{
  height: clamp(42px, 12vw, 90px);
  width: auto;
  display:block;
  filter:
    drop-shadow(0 0 8px rgba(255,210,90,0.25))
    drop-shadow(0 0 14px rgba(155,92,255,0.18));
}


.picker-heading{
  font-size: clamp(22px, 7vw, 38px);
  letter-spacing: 0.6em;
  margin-left: 0.6em;
  color: var(--gold);
  text-shadow: 0 0 15px rgba(255,210,90,.35);
  margin-bottom: 2.2vh;
}

.picker-label{
  text-align: center;
  font-size: clamp(10px, 3.2vw, 14px);
  color: var(--mystic);
  letter-spacing: 0.55em;
  font-weight: 800;
  text-transform: uppercase;
  text-shadow: 0 0 10px var(--mysticGlow1), 0 0 2px rgba(0,0,0,.85);
}

.picker-single{
  width: var(--panelW);
  display:flex;
  flex-direction:column;
  gap: 1.2vh;

  /* ✅ allow vertical centering + dynamic wheel height */
  flex: 1;
  min-height: 0;
  justify-content: center;
}

/* ===== Wheel ===== */
.wheel-mask{
  position: relative;
  width: 100%;

  /* ✅ wheel grows with screen, so more rows become visible */
  height: clamp(180px, 46vh, 560px);

  overflow: hidden;
  border-radius: 16px;
  background: rgba(255,255,255,0.02);
}

.wheel-mask::before,
.wheel-mask::after{
  content:'';
  position:absolute;
  left:0; right:0;
  height: calc(var(--rowH) * var(--padRows));
  z-index:2;
  pointer-events:none;
}

.wheel-mask::before{
  top:0;
  background: linear-gradient(to bottom, #0a0a12 0%, transparent 100%);
}
.wheel-mask::after{
  bottom:0;
  background: linear-gradient(to top, #0a0a12 0%, transparent 100%);
}

.wheel-highlight{
  position:absolute;
  top: 50%;
  transform: translateY(calc(-50% + var(--highlightOffset)));
  left: 1%;
  right: 1%;
  height: var(--rowH);
  border-radius: 14px;
  z-index:1;
  pointer-events:none;

  border: 1.5px solid rgba(212, 175, 55, 0.55);
  background: rgba(212, 175, 55, 0.08);
  box-shadow:
    0 0 18px rgba(0,0,0,.35),
    0 0 14px var(--goldGlow1),
    0 0 26px var(--goldGlow2),
    0 0 2px rgba(255,241,176,.55) inset;
}

.wheel-scroll{
  width:100%;
  height:100%;
  overflow-y:auto;
  scroll-snap-type:y mandatory;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.wheel-scroll::-webkit-scrollbar{ display:none; }

.wheel-pad{
  /* ✅ Dynamic padding rows so the center highlight stays correct
     while visible rows can grow with screen height */
  height: calc(var(--rowH) * var(--padRows));
  flex-shrink: 0;
}

.wheel-item{
  height: var(--rowH);
  display:flex;
  align-items:center;
  gap: 8px;
  padding: 0 12px;
  scroll-snap-align:center;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  transition: opacity .14s ease, transform .14s ease;
  will-change: transform, opacity;
}

.wheel-text, .wheel-num{
  transform: translateZ(0);
  -webkit-font-smoothing: antialiased;
}

.wheel-thumb{
  width: clamp(26px, 8vw, 38px);
  height: clamp(26px, 8vw, 38px);
  border-radius: 8px;
  object-fit: cover;
  background: #1a1a2e;
  flex-shrink: 0;
}

.wheel-text{
  font-size: clamp(12px, 3.6vw, 17px);
  font-weight: 700;
  color: #f0e6d0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.wheel-item-count{ justify-content:center; }
.wheel-num{
  font-size: clamp(14px, 4.2vw, 19px);
  font-weight: 800;
  color: #f0e6d0;
}

/* footer */
.picker-footer{
  width: var(--panelW);
  display:flex;
  gap: 12px;
  align-items:center;
  justify-content: space-between;
  padding-top: 1.8vh;
  padding-bottom: env(safe-area-inset-bottom);
}

.picker-footer > button{
  flex: 1 1 0;
  min-width: 0;
}

.btn-start,
.link-btn,
.icon-btn{
  min-height: var(--controlBtnH);
  height: var(--controlBtnH);
  border-radius: var(--controlRadius);
  border: 1.5px solid transparent;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 0 14px;
  transition: transform .14s ease, filter .2s ease;
  forced-color-adjust: none;
}

.btn-start{
  font-size: clamp(14px, 4vw, 18px);
  font-weight: 900;
  letter-spacing: 0.2em;

  background: linear-gradient(135deg, var(--gold3), var(--gold2));
  color: #0a0a12;
  border: none;

  box-shadow:
    0 10px 24px rgba(0,0,0,.45),
    0 0 18px rgba(255,210,90,.35);
}

.icon-btn,
.link-btn{
  border: 1.5px solid rgba(155,92,255,.56);
  background: rgba(155,92,255,.12);
  color: var(--mystic);
  box-shadow:
    0 8px 22px rgba(0,0,0,.36),
    0 0 12px rgba(155,92,255,.28);
}

.icon-btn.gold{
  border-color: rgba(212,175,55,0.55);
  background: rgba(212,175,55,0.12);
  color: var(--gold);
  box-shadow:
    0 8px 22px rgba(0,0,0,.36),
    0 0 12px rgba(255,210,90,.30);
}

.btn-start:active,
.link-btn:active,
.icon-btn:active{
  transform: scale(.985);
}

button.tap-feedback{
  animation: appButtonTap 290ms cubic-bezier(0.24, 0.78, 0.24, 1);
}

@keyframes appButtonTap{
  0%{
    transform: scale(1);
    filter: brightness(1);
  }
  34%{
    transform: scale(0.93);
    filter: brightness(1.08);
  }
  68%{
    transform: scale(1.04);
    filter: brightness(1.16);
  }
  100%{
    transform: scale(1);
    filter: brightness(1);
  }
}

.btn-label{
  font-size: clamp(11px, 3vw, 14px);
  font-weight: 900;
  letter-spacing: 0.16em;
  line-height: 1;
  white-space: nowrap;
  text-shadow: 0 0 8px currentColor;
}

.btn-start .btn-label{
  color: #1d1300;
  text-shadow: 0 0 2px rgba(255,255,255,0.25);
}

.lottie{
  width: clamp(20px, 5.8vw, 28px);
  height: clamp(20px, 5.8vw, 28px);
  flex-shrink: 0;
  display: inline-block;
}

.lottie > *{
  width: 100%;
  height: 100%;
}

#iconNextDeck{
  filter:
    drop-shadow(0 0 6px rgba(255,210,90,0.90))
    drop-shadow(0 0 14px rgba(255,174,0,0.72));
}

#iconBackCount{
  filter:
    drop-shadow(0 0 6px rgba(155,92,255,0.82))
    drop-shadow(0 0 12px rgba(93,43,255,0.58));
}

#iconStartDraw{
  filter:
    drop-shadow(0 0 3px rgba(255,248,220,0.55))
    drop-shadow(0 0 8px rgba(255,210,90,0.30));
}

#iconGridReveal{
  filter:
    drop-shadow(0 0 5px rgba(255,248,220,0.58))
    drop-shadow(0 0 10px rgba(255,210,90,0.36));
}

.picker-footer #nextBtn .lottie svg [stroke]:not([stroke="none"]),
.picker-footer #nextBtn .lottie svg [fill]:not([fill="none"]){
  stroke: #ffd36a !important;
  fill: #ffd36a !important;
}

#backBtn .lottie svg [stroke]:not([stroke="none"]),
#backBtn .lottie svg [fill]:not([fill="none"]){
  stroke: #9b5cff !important;
  fill: #9b5cff !important;
}

#startBtn .lottie svg [stroke]:not([stroke="none"]),
#startBtn .lottie svg [fill]:not([fill="none"]){
  stroke: #1d1300 !important;
  fill: #1d1300 !important;
}

#gridRevealBtn .lottie svg [stroke]:not([stroke="none"]),
#gridRevealBtn .lottie svg [fill]:not([fill="none"]){
  stroke: #1d1300 !important;
  fill: #1d1300 !important;
}

.card-nav.up .nav-btn .lottie svg [stroke]:not([stroke="none"]),
.card-nav.up .nav-btn .lottie svg [fill]:not([fill="none"]){
  stroke: #ffd36a !important;
  fill: #ffd36a !important;
}

.spread-actions .nav-btn.up .lottie svg [stroke]:not([stroke="none"]),
.spread-actions .nav-btn.up .lottie svg [fill]:not([fill="none"]){
  stroke: #ffd36a !important;
  fill: #ffd36a !important;
}

.card-nav.rev .nav-btn .lottie svg [stroke]:not([stroke="none"]),
.card-nav.rev .nav-btn .lottie svg [fill]:not([fill="none"]){
  stroke: #9b5cff !important;
  fill: #9b5cff !important;
}

.spread-actions .nav-btn.up .nav-lottie,
.card-nav.up .nav-btn .nav-lottie{
  filter:
    drop-shadow(0 0 6px rgba(255,210,90,0.86))
    drop-shadow(0 0 12px rgba(255,174,0,0.58));
}

.card-nav.rev .nav-btn .nav-lottie{
  filter:
    drop-shadow(0 0 6px rgba(155,92,255,0.84))
    drop-shadow(0 0 12px rgba(93,43,255,0.62));
}

/* ============================================================
   SHUFFLE ANIMATION
   ============================================================ */
.shuffling {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100dvh;
  width: 100vw;
}

.shuffle-cards {
  position: relative;
  width: min(70vw, 520px);
  height: min(45vh, 420px);
}

.scard {
  position: absolute;
  width: min(22vw, 150px);
  height: min(34vw, 230px);
  border-radius: 2vw;
  border: 0;
  background: linear-gradient(135deg, #1a1a2e, #16213e);
  box-shadow:
    0 2px 12px rgba(0, 0, 0, 0.5),
    inset 0 0 0 1.5px #d4af37;
  left: 50%;
  top: 50%;
  transform-origin: center center;
  overflow: hidden;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.scard::after {
  content: '✦';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 5vw;
  color: rgba(212, 175, 55, 0.5);
}

.s1 { animation: shuffleCard1 0.7s ease-in-out 4; }
.s2 { animation: shuffleCard2 0.7s ease-in-out 4; animation-delay: 0.08s; }
.s3 { animation: shuffleCard3 0.7s ease-in-out 4; animation-delay: 0.16s; }
.s4 { animation: shuffleCard4 0.7s ease-in-out 4; animation-delay: 0.24s; }
.s5 { animation: shuffleCard5 0.7s ease-in-out 4; animation-delay: 0.32s; }

@keyframes shuffleCard1 {
  0%   { transform: translate(-50%, -50%) rotate(-12deg) translateX(-14vw); }
  50%  { transform: translate(-50%, -50%) rotate(8deg) translateX(10vw) translateY(-4vh); }
  100% { transform: translate(-50%, -50%) rotate(-12deg) translateX(-14vw); }
}
@keyframes shuffleCard2 {
  0%   { transform: translate(-50%, -50%) rotate(-6deg) translateX(-7vw); }
  50%  { transform: translate(-50%, -50%) rotate(12deg) translateX(6vw) translateY(-6vh); }
  100% { transform: translate(-50%, -50%) rotate(-6deg) translateX(-7vw); }
}
@keyframes shuffleCard3 {
  0%   { transform: translate(-50%, -50%) rotate(0deg); }
  50%  { transform: translate(-50%, -50%) rotate(0deg) translateY(-8vh) scale(1.08); }
  100% { transform: translate(-50%, -50%) rotate(0deg); }
}
@keyframes shuffleCard4 {
  0%   { transform: translate(-50%, -50%) rotate(6deg) translateX(7vw); }
  50%  { transform: translate(-50%, -50%) rotate(-12deg) translateX(-6vw) translateY(-6vh); }
  100% { transform: translate(-50%, -50%) rotate(6deg) translateX(7vw); }
}
@keyframes shuffleCard5 {
  0%   { transform: translate(-50%, -50%) rotate(12deg) translateX(14vw); }
  50%  { transform: translate(-50%, -50%) rotate(-8deg) translateX(-10vw) translateY(-4vh); }
  100% { transform: translate(-50%, -50%) rotate(12deg) translateX(14vw); }
}

/* ============================================================
   FACE-DOWN GRID
   ============================================================ */
.grid-screen {
  position: relative;
  isolation: isolate;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100dvh;
  width: 100vw;
  padding:
    calc(1.5vh + env(safe-area-inset-top))
    2vw
    calc(1vh + env(safe-area-inset-bottom));

  background-image:
    linear-gradient(180deg, rgba(10,10,18,0.56) 0%, rgba(10,10,18,0.72) 100%),
    url('./assets/background/background.png');
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
}

.grid-header {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 0 2vw;
  margin-bottom: 1vh;
}

.grid-status {
  font-size: clamp(12px, 3.2vw, 16px);
  color: #d4af37;
  font-weight: 600;
}

.grid-count {
  font-size: clamp(12px, 3.2vw, 16px);
  color: #888;
}

.grid-wrap {
  flex: 1;
  width: min(100%, 1100px);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.grid-wrap::-webkit-scrollbar { display: none; }

.grid {
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  gap: 1vw;
  padding: 0 1vw 1vh;
}

/* Give 3D depth so rotateY is visible */
.grid {
  perspective: 900px;
  perspective-origin: 50% 50%;
}

.grid-card {
  transform-style: preserve-3d;
  backface-visibility: hidden;
  will-change: transform, filter;
}

/* Optional shimmer overlay to make the flip feel like a “turn” */
.grid-card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  pointer-events:none;
  opacity:0;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255, 241, 176, 0.18) 35%,
    rgba(255, 210, 90, 0.22) 50%,
    rgba(155, 92, 255, 0.14) 65%,
    transparent 100%
  );
  transform: translateX(-60%);
}

.grid-card{
  aspect-ratio: 2/3;
  border-radius: 1.2vw;
  border: 1px solid #d4af37;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: all 0.2s ease;
  position: relative;

  background-color: #111126;
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
}

.grid-card::after {
  content: '✦';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2.5vw;
  color: rgba(212, 175, 55, 0.4);
}

.grid-card:active { transform: scale(0.9); }

.grid-card.taking-away{
  animation: takeAwayCard 460ms cubic-bezier(0.21, 0.75, 0.21, 1) forwards;
}

@keyframes takeAwayCard{
  0%{
    opacity: 1;
    transform: translateY(0) scale(1) rotate(0deg);
    filter: brightness(1);
  }
  30%{
    transform: translateY(-6%) scale(1.03) rotate(-2deg);
    filter: brightness(1.14);
    box-shadow:
      0 0 12px rgba(0,0,0,0.35),
      0 0 14px var(--goldGlow1),
      0 0 26px var(--goldGlow2);
  }
  100%{
    opacity: 0;
    transform: translateY(-68%) scale(0.45) rotate(-9deg);
    filter: brightness(1.18);
  }
}

.grid-card.picked {
  background: rgba(212, 175, 55, 0.2);
  border-color: #d4af37;
  box-shadow: 0 0 8px rgba(212, 175, 55, 0.4);
  pointer-events: none;
}

.grid-card.picked{
  pointer-events: none;
  border-color: transparent;
  background: transparent;
  box-shadow: none;
  opacity: 0;
}

.grid-card.picked-glow{
  border: 1.5px solid hsla(var(--hue, 45), 100%, 70%, 0.85);
  box-shadow:
    0 0 10px hsla(var(--hue, 45), 100%, 65%, 0.55),
    0 0 18px hsla(var(--hue, 45), 100%, 60%, 0.35),
    0 0 28px hsla(var(--hue, 45), 100%, 55%, 0.25),
    0 0 2px rgba(255,255,255,0.12) inset;
  animation: pickedPulse 900ms ease-in-out infinite alternate;
}

@keyframes pickedPulse{
  0% { filter: brightness(1); transform: scale(1); }
  100% { filter: brightness(1.15); transform: scale(1.02); }
}

.grid-card.picked::after{
  content: '';
  display: none;
}

.grid-card.just-picked { animation: pickFlash 0.4s ease; }



@keyframes pickFlash {
  0% { transform: scale(1); }
  30% { transform: scale(1.15); box-shadow: 0 0 14px rgba(212, 175, 55, 0.6); }
  100% { transform: scale(1); }
}

.reveal-gif{
  width: clamp(160px, 52vw, 420px);
  height: auto;
  display:block;
  filter:
    drop-shadow(0 0 14px rgba(255,210,90,0.28))
    drop-shadow(0 0 26px rgba(155,92,255,0.22));
  animation: revealFade 0.6s ease forwards;
}

@keyframes revealFade{
  from{ opacity:0; transform: scale(.96); }
  to{ opacity:1; transform: scale(1); }
}

.grid-hint {
  font-size: clamp(12px, 3vw, 16px);
  color: #c7b8dd;
  padding: 0;
  margin: 0;
  flex-shrink: 0;
  text-align: center;
  letter-spacing: 0.02em;
}

.grid-footer{
  width: min(96vw, 560px);
  display: flex;
  flex-direction: column;
  gap: 1.2vh;
  align-items: center;
  padding: 0.8vh 0 calc(0.8vh + env(safe-area-inset-bottom));
}

.grid-reveal-btn{
  width: 100%;
  min-height: clamp(48px, 7.8vh, 62px);
  justify-content: center;
}

.grid-reveal-btn:disabled{
  opacity: 0.52;
  cursor: default;
  filter: saturate(0.75);
  box-shadow:
    0 6px 14px rgba(0,0,0,.32),
    0 0 6px rgba(255,210,90,.15);
}

.loading-screen{
  width: 100vw;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 2.2vh;
  padding:
    calc(2vh + env(safe-area-inset-top))
    4vw
    calc(2vh + env(safe-area-inset-bottom));
}

.loading-wrap{
  width: clamp(180px, 56vw, 360px);
  aspect-ratio: 1 / 1;
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 20px;
  border: 1.5px solid rgba(195,153,255,0.66);
  background:
    radial-gradient(circle at 28% 24%, rgba(255, 224, 150, 0.30) 0%, rgba(255, 224, 150, 0) 56%),
    radial-gradient(circle at 78% 80%, rgba(155, 92, 255, 0.34) 0%, rgba(155, 92, 255, 0) 58%),
    linear-gradient(150deg, rgba(70, 35, 130, 0.94), rgba(28, 14, 56, 0.97));
  box-shadow:
    0 0 22px rgba(0,0,0,0.42),
    0 0 18px rgba(255,196,120,0.34),
    0 0 30px rgba(155,92,255,0.46),
    0 0 2px rgba(255, 237, 185, 0.28) inset;
}

.loading-wrap::before{
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(132deg, rgba(255,255,255,0.14), rgba(255,255,255,0.02) 38%, rgba(255,255,255,0) 70%);
  pointer-events: none;
}

.loading-gif{
  width: 84%;
  height: 84%;
  object-fit: contain;
  position: relative;
  z-index: 1;
  display: block;
  opacity: 1;
  transition: opacity .22s ease, filter .22s ease;
}

.loading-gif.is-loading{
  opacity: 0.18;
  filter: saturate(0.84) brightness(0.94);
}

.loading-gif.is-hidden{
  opacity: 0;
}

.loading-fallback{
  position: absolute;
  inset: 0;
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: clamp(40px, 14vw, 76px);
  color: rgba(255, 224, 150, 0.86);
  text-shadow:
    0 0 10px rgba(255, 216, 120, 0.42),
    0 0 20px rgba(155, 92, 255, 0.48);
  opacity: 0;
  pointer-events: none;
  transition: opacity .22s ease;
}

.loading-fallback.show{
  opacity: 1;
  animation: loadingFallbackPulse 1.6s ease-in-out infinite;
}

@keyframes loadingFallbackPulse{
  0%, 100%{
    transform: scale(0.95);
    filter: brightness(0.95);
  }
  50%{
    transform: scale(1.05);
    filter: brightness(1.15);
  }
}

.loading-label{
  font-size: clamp(12px, 3.2vw, 17px);
  letter-spacing: 0.08em;
  color: var(--gold);
  text-shadow: 0 0 8px var(--goldGlow1);
}

/* ============================================================
   SPREAD VIEW
   ============================================================ */
.spread-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100dvh;
  width: 100vw;
  padding:
    calc(1.5vh + env(safe-area-inset-top))
    3vw
    calc(1vh + env(safe-area-inset-bottom));
}

.spread-actions{
  width: min(96vw, 680px);
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  align-items:center;
  justify-items: center;
  gap: clamp(10px, 3.6vw, 24px);
  padding: 0.8vh 0 calc(1.4vh + env(safe-area-inset-bottom));
  position: sticky;
  bottom: 0;
  background: linear-gradient(
    to top,
    rgba(19, 11, 33, 0.82) 10%,
    rgba(19, 11, 33, 0.44) 66%,
    rgba(22, 10, 40, 0.00) 100%
  );
  backdrop-filter: blur(5px);
}

.spread-header {
  width: 100%;
  margin-bottom: 1.5vh;
}

.spread-title {
  font-size: clamp(12px, 3.2vw, 16px);
  color: #d4af37;
  font-weight: 600;
  letter-spacing: 0.3vw;
}

.spread-area{
  --spread-gap: clamp(8px, 2vw, 18px);
  --spread-card-w: calc((100% - (3 * var(--spread-gap))) / 4);
  flex: 1;
  width: min(96vw, 1100px);
  display: flex;
  flex-direction: column;
  gap: 2vw;
}

.spread-area.single{
  justify-content: center;
  overflow: hidden;
}

.spread-area.scrolling{
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 1vh;
}
.spread-area.scrolling::-webkit-scrollbar{ display:none; }

/* Keep the same card size across rows when spread has 5+ cards. */
.spread-area.scrolling .spread-row{
  width: 100%;
  display: flex;
  justify-content: center;
  gap: var(--spread-gap);
}

.spread-row{
  width: 100%;
  display: grid;
  gap: 2vw;
  justify-content: center;
}

.spread-area.single .spread-row.cols-1{ grid-template-columns: minmax(0, 1fr); max-width: 62vw; margin: 0 auto; }
.spread-area.single .spread-row.cols-2{ grid-template-columns: repeat(2, minmax(0, 1fr)); max-width: 92vw; margin: 0 auto; }
.spread-area.single .spread-row.cols-3{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
.spread-area.single .spread-row.cols-4{ grid-template-columns: repeat(4, minmax(0, 1fr)); }

/* In scrolling spreads, all rows must use full width so 5/9/13/17 last-row cards stay same size. */
.spread-area.scrolling .spread-row.cols-1,
.spread-area.scrolling .spread-row.cols-2,
.spread-area.scrolling .spread-row.cols-3,
.spread-area.scrolling .spread-row.cols-4{
  width: 100%;
  max-width: none;
  margin: 0;
}

.spread-card{
  aspect-ratio: 2 / 3;
  border-radius: 2.5vw;
  overflow: hidden;
  background: rgba(255,255,255,0.03);
  position: relative;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: transform .16s ease, filter .20s ease, box-shadow .22s ease;

  border: 1.5px solid var(--gold);
  box-shadow:
    0 0 10px rgba(0,0,0,0.35),
    0 0 10px var(--goldGlow1),
    0 0 18px var(--goldGlow2),
    0 0 2px rgba(255, 241, 176, 0.55) inset;
}

.spread-card:active{
  transform: scale(0.97);
}

.spread-card.tap-feedback{
  animation: spreadCardTap 300ms cubic-bezier(0.24, 0.78, 0.24, 1);
}

@keyframes spreadCardTap{
  0%{
    transform: scale(1);
    filter: brightness(1);
  }
  38%{
    transform: scale(0.955);
    filter: brightness(1.16);
  }
  72%{
    transform: scale(1.03);
    filter: brightness(1.08);
  }
  100%{
    transform: scale(1);
    filter: brightness(1);
  }
}

.spread-area.scrolling .spread-card{
  width: var(--spread-card-w);
  min-width: var(--spread-card-w);
  flex: 0 0 var(--spread-card-w);
}

.spread-card.reversed{
  border: 1.5px solid var(--mystic);
  box-shadow:
    0 0 10px rgba(0,0,0,0.35),
    0 0 10px var(--mysticGlow1),
    0 0 18px rgba(93,43,255,0.55),
    0 0 2px var(--mysticEdge) inset;
}

.spread-img{
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

.spread-symbol { font-size: 10vw; }

.spread-card.reversed .spread-img,
.spread-card.reversed .spread-symbol{
  transform: rotate(180deg);
}

.spread-label{
  position:absolute;
  bottom:0.6vh;
  right:1.6vw;
  font-size: clamp(12px, 3.1vw, 16px);
  font-weight:900;
  opacity:0.95;
}

.spread-card.reversed .spread-label{
  color: var(--mystic);
  text-shadow:
    0 0 2px rgba(0,0,0,0.90),
    0 0 6px var(--mysticEdge),
    0 0 16px var(--mysticGlow1),
    0 0 28px rgba(93,43,255,0.55);
}

.spread-nav{
  flex-shrink: 0;
  position: sticky;
  bottom: 0;
  background: #0a0a12;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  gap: 1vh;
  width: 100%;
  padding: 1vh 0 calc(1.5vh + env(safe-area-inset-bottom));
}

/* ============================================================
   CARD DETAIL VIEW
   ============================================================ */
.card-view {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  height: 100dvh;
  width: 100vw;
  padding:
    calc(1.5vh + env(safe-area-inset-top))
    4vw
    calc(1vh + env(safe-area-inset-bottom));
}

.card-header {
  display: flex;
  justify-content: space-between;
  width: min(96vw, 680px);
  font-size: clamp(12px, 3vw, 16px);
  color: #666;
  margin-bottom: 1vh;
}

.card-count { color: #d4af37; font-weight: 600; }
.card-type { color: #888; font-style: italic; }

/* Frame now auto-updates aspect-ratio from JS */
.card-frame {
  width: clamp(190px, 54vw, 460px);
  max-height: min(64vh, 660px);
  height: auto;

  border-radius: 3vw;
  border: 1.5px solid var(--gold);
  box-shadow:
    0 0 10px rgba(0,0,0,0.35),
    0 0 10px var(--goldGlow1),
    0 0 18px var(--goldGlow2),
    0 0 2px rgba(255, 241, 176, 0.55) inset;
  overflow: hidden;
  background: #0a0a12;

  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;

  /* sensible default until JS sets real ratio */
  aspect-ratio: 2 / 3;
}

.card-frame.tap-back{
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.card-frame.tap-back:active{
  transform: scale(0.995);
}

.card-frame.tap-feedback{
  animation: cardFrameTap 320ms cubic-bezier(0.24, 0.78, 0.24, 1);
}

@keyframes cardFrameTap{
  0%{
    transform: scale(1);
    filter: brightness(1);
  }
  36%{
    transform: scale(0.968);
    filter: brightness(1.16);
  }
  72%{
    transform: scale(1.014);
    filter: brightness(1.08);
  }
  100%{
    transform: scale(1);
    filter: brightness(1);
  }
}

.card-frame.up{
  border-color: var(--gold);
  box-shadow:
    0 0 20px rgba(0,0,0,0.35),
    0 0 14px var(--goldGlow1),
    0 0 26px var(--goldGlow2),
    0 0 2px rgba(255, 241, 176, 0.55) inset;
}

.card-frame.rev{
  border-color: var(--mystic);
  box-shadow:
    0 0 20px rgba(0,0,0,0.35),
    0 0 16px var(--mysticGlow1),
    0 0 32px rgba(93,43,255,0.55),
    0 0 3px var(--mysticEdge) inset;
}

.card-img-wrap {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
}

.card-img-wrap.reversed { transform: rotate(180deg); }

/* contain (no crop) so every deck looks correct */
.card-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.card-symbol-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  transition: transform 0.3s ease;
}

.card-symbol-wrap.reversed { transform: rotate(180deg); }

.card-big-symbol {
  font-size: clamp(64px, 20vw, 140px);
  filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3));
}

.card-fallback {
  font-size: clamp(14px, 4.5vw, 20px);
  color: #d4af37;
  text-align: center;
  padding: 4vw;
  font-weight: 600;
  line-height: 2;
}

.card-info {
  width: min(96vw, 680px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1 1 auto;
  min-height: 0;
  gap: clamp(4px, 0.9vh, 10px);
  margin: 0;
  flex-shrink: 1;
}

.card-name {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  max-width: min(94vw, 640px);
  padding: clamp(4px, 0.9vh, 9px) clamp(14px, 4.2vw, 30px);
  border-radius: 999px;
  border: 1px solid rgba(255, 224, 152, 0.38);
  background:
    radial-gradient(circle at 50% 0%, rgba(255, 235, 185, 0.16), rgba(255, 235, 185, 0) 62%),
    linear-gradient(180deg, rgba(255, 233, 190, 0.06), rgba(255, 233, 190, 0.02));
  font-family: "Cinzel", "Cormorant Garamond", "Times New Roman", serif;
  font-size: clamp(18px, 4.9vw, 28px);
  font-weight: 700;
  letter-spacing: 0.045em;
  text-align: center;
  color: #f7ebcf;
  text-shadow:
    0 1px 3px rgba(0, 0, 0, 0.58),
    0 0 10px rgba(255, 214, 130, 0.34);
  line-height: 1.2;
  box-shadow:
    0 0 10px rgba(0, 0, 0, 0.26),
    0 0 12px rgba(255, 205, 112, 0.20),
    0 0 1px rgba(255, 245, 216, 0.24) inset;
}

.card-name.up{
  border-color: rgba(255, 224, 152, 0.42);
  color: #f7ebcf;
  text-shadow:
    0 1px 3px rgba(0, 0, 0, 0.58),
    0 0 10px rgba(255, 214, 130, 0.34);
}

.card-name.rev{
  border-color: rgba(200, 165, 255, 0.44);
  background:
    radial-gradient(circle at 50% 0%, rgba(212, 173, 255, 0.17), rgba(212, 173, 255, 0) 62%),
    linear-gradient(180deg, rgba(214, 181, 255, 0.07), rgba(214, 181, 255, 0.03));
  color: #efe3ff;
  text-shadow:
    0 1px 3px rgba(31, 17, 52, 0.62),
    0 0 10px rgba(173, 119, 255, 0.38);
  box-shadow:
    0 0 10px rgba(0, 0, 0, 0.26),
    0 0 12px rgba(165, 109, 255, 0.24),
    0 0 1px rgba(238, 219, 255, 0.24) inset;
}

.card-orientation{
  font-size: clamp(12px, 2vw, 14px);
  font-weight: 800;
  letter-spacing: 0.2vw;
  padding: 0.6vw 2vw;
  border-radius: 4vw;
  border: 1px solid transparent;
}

.card-orientation.up{
  color: var(--gold);
  border: 1.5px solid var(--gold);
  box-shadow:
    0 0 20px rgba(0,0,0,0.35),
    0 0 14px var(--goldGlow1),
    0 0 26px var(--goldGlow2),
    0 0 2px rgba(255, 241, 176, 0.55) inset;
  text-shadow:
    0 0 2px rgba(0,0,0,0.85),
    0 0 8px var(--goldGlow1);
  background: rgba(212,175,55,0.10);
  border-color: rgba(212,175,55,0.55);
}

.card-orientation.rev{
  color: var(--mystic);
  background: rgba(155,92,255,0.12);
  border: 1.5px solid rgba(155,92,255,0.65);
  box-shadow:
    0 0 20px rgba(0,0,0,0.35),
    0 0 14px var(--mysticEdge),
    0 0 26px var(--mysticGlow2),
    0 0 2px rgba(157, 3, 149, 0.55) inset;
  text-shadow:
    0 0 2px rgba(77, 0, 68, 0.85),
    0 0 8px var(--mysticGlow1);
}

/* COPY button (keeps your glow aesthetic) */
.btn-copy{
  width: min(92vw, 520px);
  min-height: 44px;
  padding: 12px 0;
  font-size: clamp(13px, 3.4vw, 16px);
  font-weight: 900;
  letter-spacing: 0.22em;
  border-radius: 14px;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  border: 1.5px solid rgba(212,175,55,0.55);

  background: rgba(212,175,55,0.10);
  color: var(--gold);
  text-shadow: 0 0 8px var(--goldGlow1);

  box-shadow:
    0 0 10px rgba(0,0,0,0.35),
    0 0 10px var(--goldGlow1),
    0 0 18px var(--goldGlow2),
    0 0 2px rgba(255, 241, 176, 0.35) inset;

  forced-color-adjust: none;
}

.btn-copy.rev{
  border-color: rgba(155,92,255,0.65);
  color: var(--mystic);
  background: rgba(155,92,255,0.10);
  text-shadow: 0 0 8px var(--mysticGlow1);
  box-shadow:
    0 0 10px rgba(0,0,0,0.35),
    0 0 10px var(--mysticGlow1),
    0 0 18px rgba(93,43,255,0.55),
    0 0 2px var(--mysticEdge) inset;
}

.btn-copy:active{ transform: scale(0.985); }

.toast{
  height: 18px;
  font-size: 12px;
  color: #aaa;
  opacity: 0;
  transition: opacity .18s ease;
}
.toast.show{ opacity: 1; }

/* Navigation */
.card-nav {
  display: grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  align-items: center;
  justify-items: center;
  gap: clamp(8px, 2.8vw, 18px);
  margin-top: 0;
  padding-bottom: calc(1.5vh + env(safe-area-inset-bottom));
  width: min(96vw, 680px);
  flex-shrink: 0;
}

.card-view > .toast{
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: min(96vw, 680px);
  text-align: center;
  pointer-events: none;
  bottom: calc(72px + env(safe-area-inset-bottom));
}

.card-nav .nav-btn{
  width: min(100%, 66px);
  height: auto;
  aspect-ratio: 1 / 1;
  min-width: 44px;
  min-height: 44px;

  border-radius: var(--controlRadius);
  border: 1.5px solid rgba(212,175,55,0.55);
  background: rgba(212,175,55,0.10);
  color: #d4af37;
  font-size: clamp(18px, 5.4vw, 28px);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  padding: 0;
  line-height: 1;
  box-shadow:
    0 0 12px rgba(0,0,0,0.35),
    0 0 10px var(--goldGlow1),
    0 0 18px rgba(255,170,0,0.22);
}



.nav-btn.up { color: var(--gold); }
.nav-btn.rev {
  color: var(--mystic);
  border-color: rgba(155,92,255,0.65);
  background: rgba(155,92,255,0.12);
  box-shadow:
    0 0 12px rgba(0,0,0,0.35),
    0 0 11px var(--mysticGlow1),
    0 0 20px rgba(93,43,255,0.25);
}

.nav-btn:disabled {
  opacity: 0.25;
  pointer-events: none;
}

.card-nav .nav-btn{
  transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
}

.card-nav .nav-btn.copy-feedback{
  transform: scale(1.06);
  filter: brightness(1.12);
}

.card-nav.up .nav-btn.copy-feedback{
  box-shadow:
    0 0 16px rgba(0,0,0,0.35),
    0 0 14px var(--goldGlow1),
    0 0 24px rgba(255,170,0,0.32);
}

.card-nav.rev .nav-btn.copy-feedback{
  box-shadow:
    0 0 16px rgba(0,0,0,0.35),
    0 0 14px var(--mysticGlow1),
    0 0 24px rgba(93,43,255,0.34);
}

/* only a slight accent on "back to spread" */
.card-nav.up .nav-btn.home-btn{
  border-color: rgba(255,225,128,0.72);
  box-shadow:
    0 0 14px rgba(0,0,0,0.35),
    0 0 12px rgba(255,210,90,0.46),
    0 0 20px rgba(255,174,0,0.30);
}

.card-nav.rev .nav-btn.home-btn{
  border-color: rgba(190,146,255,0.78);
  box-shadow:
    0 0 14px rgba(0,0,0,0.35),
    0 0 12px rgba(155,92,255,0.44),
    0 0 20px rgba(93,43,255,0.31);
}

.spread-actions .nav-btn{
  width: min(100%, 66px);
  height: auto;
  aspect-ratio: 1 / 1;
  min-width: 44px;
  min-height: 44px;
  border-radius: var(--controlRadius);
  border: 1.5px solid rgba(212,175,55,0.55);
  background: rgba(212,175,55,0.10);
  color: #d4af37;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  padding: 0;
  line-height: 1;
  box-shadow:
    0 0 12px rgba(0,0,0,0.35),
    0 0 10px var(--goldGlow1),
    0 0 18px rgba(255,170,0,0.22);
  transition: transform .16s ease, box-shadow .22s ease, filter .22s ease;
}

.spread-actions .nav-btn:active{
  transform: scale(0.985);
}

.spread-actions .nav-lottie{
  width: clamp(24px, 7.2vw, 34px);
  height: clamp(24px, 7.2vw, 34px);
}

.card-nav .nav-lottie{
  width: clamp(24px, 7.2vw, 34px);
  height: clamp(24px, 7.2vw, 34px);
}

/* ============================================================
   R1 SHORT SCREEN SAFETY
   ============================================================ */
@media (max-height: 520px), (max-width: 420px) {
  :root{
    --panelW: min(92vw, 320px);
    --rowH: clamp(40px, 12.5vw, 54px);
  }

  .picker-screen{
    padding:
      calc(1.5vh + env(safe-area-inset-top))
      3vw
      calc(1.5vh + env(safe-area-inset-bottom));
  }

  .picker-heading{
    font-size: 6vw;
    letter-spacing: 3vw;
    margin-bottom: 1vh;
  }

  .wheel-mask{
    height: min(240px, 40vh);
  }

  .btn-start{
    padding: 12px 0;
    font-size: clamp(16px, 4.6vw, 20px);
  }
}

.grid-card.flip{
  animation: cardFlip 0.6s ease both;
  transform-style: preserve-3d;
}

@keyframes cardFlip{
  0%   { transform: rotateY(0deg) scale(1); }
  45%  { transform: rotateY(90deg) scale(1.05); box-shadow: 0 0 18px rgba(212,175,55,0.55); }
  100% { transform: rotateY(180deg) scale(1); }
}
